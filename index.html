<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>學霸課表</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#4a90e2">
  <link rel="stylesheet" href="styles.css">
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
</head>
<body>
  <nav>
    <h1 id="app-title">📅 CampusMate</h1>
    <div id="user-info" style="display: none; align-items: center; gap: 10px;">
      <span id="user-badge"
        style="font-size: 0.8rem; background: rgba(255,255,255,0.2); padding: 4px 8px; border-radius: 4px;"></span>
      <img id="user-photo" src="" style="width: 28px; height: 28px; border-radius: 50%; object-fit: cover;">

    </div>
  </nav>

  <div id="login-overlay">
    <div class="login-card">
      <h1 style="margin-top:0;">🎓 歡迎使用</h1>
      <div id="email-form">
        <input type="email" id="email" class="login-input" placeholder="電子信箱 (Email)">
        <input type="password" id="password" class="login-input" placeholder="密碼 (至少6位數)">
        <button class="btn-primary" onclick="handleEmailAuth()" id="btn-submit">登入</button>
        <p style="font-size: 0.9rem; color: #666;">
          <span id="toggle-text">還沒有帳號？</span>
          <span class="text-link" onclick="toggleLoginMode()" id="toggle-btn">建立新帳號</span>
        </p>
      </div>
      <div class="divider">或使用其他方式</div>
      <button class="btn-google" onclick="loginWithGoogle()" style="margin-top:0;">
        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18"> Google 登入
      </button>
      <button class="btn-anon" onclick="loginAnonymously()">👻 匿名試用</button>
    </div>
  </div>

  <div class="container">

    <div id="view-home">
      <div class="semester-control">
        <select id="semester-select" class="semester-select" onchange="switchSemester()"></select>
        <button class="btn-icon" onclick="editSemester()">✏️</button>
        <button class="btn-icon btn-delete-sem" onclick="deleteSemester()" style="color: #e74c3c;">🗑️</button>
        <button class="btn-new-sem" onclick="addNewSemester()">+ 新學期</button>
      </div>

      <div class="card">
        <div class="week-tabs">
          <button class="tab-btn" onclick="switchDay(1)" id="tab-1">一</button>
          <button class="tab-btn" onclick="switchDay(2)" id="tab-2">二</button>
          <button class="tab-btn" onclick="switchDay(3)" id="tab-3">三</button>
          <button class="tab-btn" onclick="switchDay(4)" id="tab-4">四</button>
          <button class="tab-btn" onclick="switchDay(5)" id="tab-5">五</button>
        </div>
        <h2 id="schedule-title">本日課程</h2>
        <table id="schedule-table">
          <thead>
            <tr>
              <th width="15%">節次</th>
              <th width="20%">時間</th>
              <th width="25%">科目</th>
              <th width="20%">地點</th>
              <th width="20%">老師</th>
            </tr>
          </thead>
          <tbody id="schedule-body"></tbody>
        </table>
        <button class="btn btn-add" onclick="openEditModal()">+ 編輯本日課程</button>
      </div>

      <div class="card">
        <h2>📊 成績單</h2>
        <table id="grade-table">
          <thead>
            <tr>
              <th>科目</th>
              <th class="uni-only">學分</th>
              <th class="uni-only">實得</th>
              <th>分數</th>
            </tr>
          </thead>
          <tbody id="grade-body"></tbody>
        </table>
        <div style="margin-top: 15px; text-align: right; font-weight: bold; color: var(--primary);">
          <span id="average-score" style="font-size: 1.1rem;">0.0</span>
        </div>
        <button class="btn btn-add" onclick="openGradeModal()">+ 編輯成績</button>
      </div>
    </div>

    <div id="view-info" style="display: none;">
      <div class="card">
        <h2>ℹ️ 關於 CampusMate</h2>
        <div id="info-content" style="padding: 10px; line-height: 1.6;">
          <p>這是一個專為學生設計的課表與成績管理工具。</p>
          <h4 style="color: var(--primary);">使用說明</h4>
          <ul>
            <li>點擊「+ 新學期」可以管理不同學期的資料。</li>
            <li>大學生模式會自動計算加權 GPA。</li>
            <li>高中生模式專注於分數算術平均。</li>
          </ul>
          <hr style="border:0; border-top:1px solid #eee; margin:15px 0;">
          <p style="font-size:0.9rem; color:#888;">版本：v2.0.0<br>開發者：CampusMate Team</p>
        </div>

        <!-- 管理者工具 -->
        <div id="admin-panel" style="display: none; border-top: 2px dashed #ccc; margin-top: 15px; padding-top: 15px;">
          <h4 style="color: var(--danger);">🛠️ 管理者工具</h4>
          <textarea id="admin-new-info" style="width:100%; height:80px; margin-bottom:10px;"
            placeholder="輸入新的公告或資訊..."></textarea>
          <button class="btn" onclick="addAdminInfo()" style="background: var(--danger);">發布公告</button>
        </div>
      </div>
    </div>

    <div id="view-settings" style="display: none;">
      <div class="card">
        <h2>⚙️ 設定</h2>
        
        <h4 style="color: var(--primary); margin-bottom: 5px;">一般設定</h4>
        <div class="settings-list">
          <div class="settings-item" onclick="resetIdentity()">
            <div><span class="settings-icon">🎓</span>切換身分 (高中/大學)</div>
            <span class="settings-arrow">➤</span>
          </div>
          </div>

        <h4 style="color: var(--danger); margin-bottom: 5px; margin-top: 20px;">帳號管理</h4>
        <div class="settings-list">
           <div class="settings-item" onclick="logout()" style="color: var(--danger);">
            <div><span class="settings-icon">🚪</span>登出帳號</div>
          </div>
        </div>
      </div>
      
      <div style="text-align: center; color: #aaa; font-size: 0.8rem; margin-top: 20px;">
        CampusMate Settings
      </div>
    </div>
  </div>

  <div class="bottom-nav">
    <button class="nav-btn active" onclick="switchTab('home')" id="btn-home">
      <span style="font-size: 1.2rem;">🏠</span><br>首頁
    </button>
    <button class="nav-btn" onclick="switchTab('info')" id="btn-info">
      <span style="font-size: 1.2rem;">ℹ️</span><br>資訊
    </button>
    <button class="nav-btn" onclick="switchTab('settings')" id="btn-settings">
      <span style="font-size: 1.2rem;">⚙️</span><br>設定
    </button>
  </div>

  <div id="welcome-modal" class="modal">
    <div class="modal-content">
      <h3>🎓 歡迎使用</h3>
      <p>請問您的身分是？</p>
      <button class="modal-btn" onclick="setUserType('highschool')">我是高中生</button>
      <button class="modal-btn" onclick="setUserType('university')">我是大學生</button>
    </div>
  </div>

  <div id="course-modal" class="modal">
    <div class="modal-content" style="text-align: left;">
      <h3 style="text-align: center; margin-top:0;">✏️ 編輯課程</h3>
      <div id="current-course-list" style="margin-bottom: 20px; max-height: 150px; overflow-y: auto;"></div>
      <hr style="border:0; border-top:1px dashed #ddd; margin: 15px 0;">
      <h4 style="margin: 0 0 10px 0; color: var(--primary);">新增一堂課</h4>
      <div class="input-group"><label>節次 (如: 1, 2, A)</label><input type="text" id="input-period" placeholder="輸入節次...">
      </div>
      <div class="input-group"><label>時間 (如: 08:10)</label><input type="text" id="input-time" placeholder="輸入時間...">
      </div>
      <div class="input-group"><label>科目</label><input type="text" id="input-subject" placeholder="輸入科目..."></div>
      <div class="input-group"><label>地點</label><input type="text" id="input-room" placeholder="輸入地點..."></div>
      <div class="input-group"><label>老師 (選填)</label><input type="text" id="input-teacher" placeholder="輸入老師...">
      </div>
      <button class="btn" style="width: 100%; background: #333;" onclick="addCourse()">+ 加入清單</button>
      <button class="btn"
        style="width: 100%; margin-top: 10px; background: transparent; color: #666; border: 1px solid #ddd;"
        onclick="closeEditModal()">關閉</button>
    </div>
  </div>

  <div id="grade-modal" class="modal">
    <div class="modal-content" style="text-align: left;">
      <h3 style="text-align: center; margin-top:0;">📊 編輯成績</h3>
      <div id="current-grade-list" style="margin-bottom: 20px; max-height: 150px; overflow-y: auto;"></div>
      <hr style="border:0; border-top:1px dashed #ddd; margin: 15px 0;">
      <h4 style="margin: 0 0 10px 0; color: var(--primary);">新增一科</h4>
      <div class="input-group"><label>科目名稱</label><input type="text" id="input-grade-subject" placeholder="例如：微積分">
      </div>
      <div class="input-group" id="input-credit-group"><label>學分</label><input type="number" id="input-grade-credit"
          placeholder="例如：3" value="1"></div>
      <div class="input-group"><label>分數</label><input type="number" id="input-grade-score" placeholder="例如：85">
      </div>
      <button class="btn" style="width: 100%; background: #333;" onclick="addGrade()">+ 加入成績單</button>
      <button class="btn"
        style="width: 100%; margin-top: 10px; background: transparent; color: #666; border: 1px solid #ddd;"
        onclick="closeGradeModal()">關閉</button>
    </div>
  </div>

  <!-- <script src="js/script.js"></script>
  <script>if ('serviceWorker' in navigator) { navigator.serviceWorker.register('./js/sw.js'); }</script> -->
  <!-- JavaScript分檔 -->
  <script src="js/firebase.js"></script>
  <script src="js/state.js"></script>
  <script src="js/ui.js"></script>
  <script src="js/course.js"></script>
  <script src="js/grade.js"></script>
  <script src="js/data.js"></script>
  <script src="js/semester.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/main.js"></script>

  <script>if ('serviceWorker' in navigator) { navigator.serviceWorker.register('./sw.js'); }</script>
</body>

</html>



